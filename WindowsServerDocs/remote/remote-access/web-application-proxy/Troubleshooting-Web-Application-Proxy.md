---
title: Solução de problemas do Proxy de aplicativo Web
ms.author: kgremban
author: eross-msft
ms.date: 07/13/2016
ms.topic: article
ms.assetid: a2fef55d-747b-4e20-8f21-5f8807e7ef87
ms.openlocfilehash: 7b7cbb22bbda690f957babcf56e97b6d846cc738
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/07/2020
ms.locfileid: "87939807"
---
# <a name="troubleshooting-web-application-proxy"></a>Solução de problemas do Proxy de aplicativo Web

>Aplica-se a: Windows Server 2016

**Esse conteúdo é relevante para a versão local do proxy de aplicativo Web. Para habilitar o acesso seguro a aplicativos locais na nuvem, consulte o conteúdo de [proxy de aplicativo do AD do Azure](/azure/active-directory/manage-apps/application-proxy).**

Esta seção fornece procedimentos de solução de problemas para o proxy de aplicativo Web, incluindo explicações e soluções de eventos. Há três locais em que os erros são exibidos:

-   No console do administrador do proxy de aplicativo Web

    Cada ID de evento listada no console do administrador do pode ser exibida na Visualizador de Eventos do Windows e as descrições e soluções correspondentes são encontradas abaixo.

    Abra Visualizador de eventos e procure eventos relacionados ao proxy de aplicativo Web em **logs de aplicativos e serviços**  >  **Microsoft**  >  **Windows**  >  Administração do**proxy de aplicativo Web**  >  **Admin** do Microsoft Windows

    ![Informações de administrador, mostradas no Visualizador de Eventos](media/Troubleshooting-Web-Application-Proxy/WebApplicationProxyTroubleshooting.png)

    Se necessário, os logs detalhados estão disponíveis ativando os logs de análise e depuração e ativando o log de sessão de proxy de aplicativo Web, encontrado no Windows Visualizador de Eventos em \ Microsoft \ Windows \ proxy de aplicativo Web \ admin.

-   Em erros do PowerShell

    Eventos para problemas encontrados durante a configuração são exibidos no PowerShell.

    Todos os erros são apresentados ao usuário do PowerShell usando prompts de erro padrão do PowerShell. Todos os comandos do PowerShell são registrados como eventos. Todos os eventos que ocorrem no PowerShell são listados na Visualizador de Eventos do Windows com o número de ID 12016 e são definidos abaixo na seção do PowerShell.

-   No Analisador de Práticas Recomendadas

    Esses eventos são descritos na [analisador de práticas recomendadas para o proxy de aplicativo Web](assetId:///995f5cea-e334-4ce6-a14c-6a2d03c0c79a)

## <a name="powershell-messages"></a>Mensagens do PowerShell

|Evento ou sintoma|Causa possível|Resolução|
|--------------------|------------------|--------------|
|O certificado de confiança ("ADFS ProxyTrust- <WAP machine name> ") não é válido|Isso pode ser provocado por qualquer um dos seguintes:<p>-O computador do proxy de aplicativo estava inoperante por muito tempo.<br />-Desconexões entre o proxy de aplicativo Web e AD FS<br />-Problemas de infraestrutura de certificado<br />-As alterações na máquina AD FS ou o processo de renovação entre o proxy de aplicativo Web e o AD FS não foram executados conforme planejado a cada 8 horas e, em seguida, eles precisam renovar a confiança<br />-O relógio do computador proxy de aplicativo Web e os AD FS não estão sincronizados.|Verifique se os relógios estão sincronizados. Execute o cmdlet Install-WebApplicationProxy.|
|Os dados de configuração não foram encontrados no AD FS|Isso pode ocorrer porque o proxy de aplicativo Web ainda não foi totalmente instalado ou devido a alterações no banco de dados AD FS ou corrupção do banco de dados.|Executar o cmdlet Install-WebApplicationProxy|
|Ocorreu um erro quando o proxy de aplicativo Web tentou ler a configuração de AD FS.|Isso pode indicar que AD FS não está acessível ou que AD FS encontrou um problema interno ao tentar ler a configuração do banco de dados AD FS.|Verifique se AD FS está acessível e funcionando corretamente.|
|Os dados de configuração armazenados no AD FS estão corrompidos ou o proxy de aplicativo Web não pôde analisá-lo.<p>OU<p>O aplicativo Web Proxywas não pode recuperar a lista de terceiras partes confiáveis de AD FS.|Isso pode ocorrer se os dados de configuração foram modificados em AD FS.|Reinicie o aplicativo Web Proxyservice. Se o problema persistir, execute o cmdlet Install-WebApplicationProxy.|

## <a name="administrator-console-events"></a>Eventos de Console do Administrador
Os eventos do console do administrador a seguir geralmente são indícios de erros de autenticação, tokes inválidos ou cookies expirados.

|Evento ou sintoma|Causa possível|Resolução|
|--------------------|------------------|--------------|
|11005<p>O proxy de aplicativo Web não pôde criar a chave de criptografia de cookie usando o segredo da configuração.|O parâmetro "AccessCookiesEncryptionKey" da configuração global foi alterado pelo comando do PowerShell: Set-WebApplicationProxyConfiguration-RegenerateAccessCookiesEncryptionKey|Nenhuma ação é necessária. O cookie problemático foi removido e o usuário foi redirecionado para o STS para autenticação.|
|12000<p>O proxy de aplicativo Web não pôde verificar se há alterações de configuração por pelo menos 60 minutos|O proxy de aplicativo Web não pode acessar a configuração de proxy de aplicativo Web usando o comando Get-WebApplicationProxyConfiguration/Application. Isso geralmente é causado por falta de conectividade com AD FS ou a necessidade de renovar a confiança com AD FS.|Verifique a conectividade com AD FS. Você pode fazer isso usando o link https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlVerifique se há confiança estabelecida entre o AD FS e o proxy de aplicativo Web. Se essas soluções não funcionarem, execute o cmdlet Install-WebApplicationProxy.|
|12003<p>O proxy de aplicativo Web não pôde analisar o cookie de acesso.|Isso pode indicar que o proxy de aplicativo Web e o AD FS não estão conectados ou que não recebem a mesma configuração.|Verifique a conectividade com AD FS. Você pode fazer isso usando o link https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlVerifique se há confiança estabelecida entre o AD FS e o proxy de aplicativo Web. Se essas soluções não funcionarem, execute o cmdlet Install-WebApplicationProxy.|
|12004<p>O proxy de aplicativo Web recebeu uma solicitação com um cookie de acesso não válido.|Esse evento pode indicar que o proxy de aplicativo Web e o AD FS não estão conectados ou que não recebem a mesma configuração.<p>Se você executou o parâmetro "AccessCookiesEncryptionKey" foi chaged pelo comando do PowerShell Set-WebApplicationProxyConfiguration-RegenerateAccessCookiesEncryptionKey, esse evento será normal e não exigirá nenhuma etapa de resolução.|Verifique a conectividade com AD FS. Você pode fazer isso usando o link https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlVerifique se há confiança estabelecida entre o AD FS e o proxy de aplicativo Web. Se essas soluções não funcionarem, execute o cmdlet Install-WebApplicationProxy.|
|12008<p>O proxy de aplicativo Web excedeu o número máximo de tentativas de autenticação Kerberos permitidas para o servidor de back-end.|Esse evento pode indicar uma configuração incorreta entre o proxy de aplicativo Web e o servidor de aplicativos de back-end, ou um problema na configuração de data e hora em ambos os computadores.|O servidor back-end recusou o tíquete Kerberos criado pelo proxy de aplicativo Web. Verifique se a configuração do proxy de aplicativo Web e o servidor de aplicativos back-end estão configurados corretamente.<p>Verifique se a configuração de data e hora no proxy de aplicativo Web e no servidor de aplicativos de back-end estão sincronizadas.|
|12011<p>O proxy de aplicativo Web recebeu uma solicitação com uma assinatura de cookie de acesso não válida.|Esse evento pode indicar que o proxy de aplicativo Web e o AD FS não estão conectados ou que não recebem a mesma configuração. Se você executou o parâmetro "AccessCookiesEncryptionKey" foi chaged pelo comando do PowerShell Set-WebApplicationProxyConfiguration-RegenerateAccessCookiesEncryptionKey, esse evento será normal e não exigirá nenhuma etapa de resolução.|Verifique a conectividade com AD FS. Você pode fazer isso usando o link https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlVerifique se há confiança estabelecida entre o AD FS e o proxy de aplicativo Web. Se essas soluções não funcionarem, execute o cmdlet Install-WebApplicationProxy.|
|12027<p>O proxy encontrou um erro inesperado ao processar a solicitação. O nome fornecido não é um nome de conta formado corretamente.|Esse evento pode indicar uma configuração incorreta entre o proxy do aplicativo Web e o servidor do controlador de domínio, ou um problema na configuração de data e hora em ambos os computadores.|O controlador de domínio recusou o tíquete Kerberos criado pelo proxy de aplicativo Web. Verifique se a configuração do proxy de aplicativo Web e o servidor de aplicativos back-end estão configurados corretamente, especialmente a configuração de SPN. Verifique se o proxy de aplicativo Web está ingressado no domínio no mesmo domínio que o controlador de domínio para garantir que o controlador de domínio estabeleça confiança com o proxy de aplicativo Web. Verifique se a configuração de data e hora no proxy de aplicativo Web e no controlador de domínio estão sincronizadas.|
|13012<p>O proxy de aplicativo Web recebeu uma assinatura de token de borda inválida||Verifique se você atualizou o proxy de aplicativo Web com [KB 2955164](https://go.microsoft.com/fwlink/?LinkId=400701).|
|13013<p>O proxy de aplicativo Web recebeu uma solicitação que continha um token de borda expirado.|O proxy de aplicativo Web e AD FS não têm relógios sincronizados.|Sincronize os relógios entre o proxy de aplicativo Web e AD FS.|
|13014<p>O proxy de aplicativo Web recebeu uma solicitação com um token de borda inválido. O token não é válido porque não pôde ser analisado.|Isso pode indicar um problema com a configuração de AD FS.|Verifique sua configuração de AD FS e, se necessário, restaure a configuração padrão.|
|13015<p>O proxy de aplicativo Web recebeu uma solicitação com um cookie de acesso expirado.|Isso pode indicar relógios que não estão sincronizados.|Se você estiver trabalhando com um cluster de máquinas de proxy de aplicativo Web, verifique se a hora e a data das máquinas estão sincronizadas.|
|13016<p>O proxy de aplicativo Web não pode recuperar um tíquete Kerberos em nome do usuário porque não há nenhum UPN no token de borda ou no cookie de acesso.|Há um problema com a configuração de STS.|Corrija a configuração de declaração UPN no STS.|
|13019<p>O proxy de aplicativo Web não pode recuperar um tíquete Kerberos em nome do usuário devido ao seguinte erro geral de API|Esse evento pode indicar uma configuração incorreta entre o proxy do aplicativo Web e o servidor do controlador de domínio, ou um problema na configuração de data e hora em ambos os computadores.|O controlador de domínio recusou o tíquete Kerberos criado pelo proxy de aplicativo Web. Verifique se a configuração do proxy de aplicativo Web e o servidor de aplicativos back-end estão configurados corretamente, especialmente a configuração de SPN. Verifique se o proxy de aplicativo Web está ingressado no domínio no mesmo domínio que o controlador de domínio para garantir que o controlador de domínio estabeleça confiança com o proxy de aplicativo Web. Verifique se a configuração de data e hora no proxy de aplicativo Web e no controlador de domínio estão sincronizadas.|
|13020<p>O proxy de aplicativo Web não pode recuperar um tíquete Kerberos em nome do usuário porque o SPN do servidor de back-end não está definido.|Esse evento pode indicar uma configuração incorreta entre o proxy do aplicativo Web e o servidor do controlador de domínio, ou um problema na configuração de data e hora em ambos os computadores.|O controlador de domínio recusou o tíquete Kerberos criado pelo proxy de aplicativo Web. Verifique se a configuração do proxy de aplicativo Web e o servidor de aplicativos back-end estão configurados corretamente, especialmente a configuração de SPN. Verifique se o proxy de aplicativo Web está ingressado no domínio no mesmo domínio que o controlador de domínio para garantir que o controlador de domínio estabeleça confiança com o proxy de aplicativo Web. Verifique se a configuração de data e hora no proxy de aplicativo Web e no controlador de domínio estão sincronizadas.|
|13022<p>O proxy de aplicativo Web não pode autenticar o usuário porque o servidor back-end responde às tentativas de autenticação Kerberos com um erro HTTP 401.|Esse evento pode indicar uma configuração incorreta entre o proxy de aplicativo Web e o servidor de aplicativos de back-end, ou um problema na configuração de data e hora em ambos os computadores.|O servidor back-end recusou o tíquete Kerberos criado pelo proxy de aplicativo Web. Verifique se a configuração do proxy de aplicativo Web e o servidor de aplicativos back-end estão configurados corretamente. Verifique se a configuração de data e hora no proxy de aplicativo Web e no servidor de aplicativos de back-end estão sincronizadas.|
|13025<p>O cliente não apresentau um certificado SSL para o proxy de aplicativo Web.|Esse evento pode indicar um problema na configuração de data e hora.|Verifique se a infraestrutura de certificado é válida e se a hora e a data do proxy de aplicativo Web e as AD FS estão sincronizadas. Certifique-se de que a impressão digital configurada para o proxy de aplicativo Web seja a correta.|
|13026<p>O cliente apresentou um certificado SSL para o proxy de aplicativo Web, mas o certificado não é válido: o certificado não corresponde à impressão digital.|Esse evento pode indicar um problema na configuração de data e hora.|Verifique se a infraestrutura de certificado é válida e se a hora e a data do proxy de aplicativo Web e as AD FS estão sincronizadas. Certifique-se de que a impressão digital configurada para o proxy de aplicativo Web seja a correta.|
|13028<p>O proxy de aplicativo Web recebeu uma solicitação que continha um token de borda que ainda não é válido.|Esse evento pode indicar um problema na configuração de data e hora.|Verifique se a infraestrutura de certificado é válida e se a hora e a data do proxy de aplicativo Web e as AD FS estão sincronizadas.|
|13030<p>O cliente apresentou um certificado SSL para o proxy de aplicativo Web, mas o provedor de confiança não confia na autoridade de certificação que emitiu o certificado do cliente.|Esse evento pode indicar um problema na configuração de data e hora.|Verifique se a infraestrutura de certificado é válida e se a hora e a data do proxy de aplicativo Web e as AD FS estão sincronizadas. Certifique-se de que a impressão digital configurada para o proxy de aplicativo Web seja a correta.|
|13031<p>O cliente apresentou um certificado SSL para o proxy de aplicativo Web, mas a cadeia de certificados foi encerrada em um certificado raiz que não é confiável para o provedor de confiança.|Esse evento pode indicar um problema na configuração de data e hora.|Verifique se a infraestrutura de certificado é válida e se a hora e a data do proxy de aplicativo Web e as AD FS estão sincronizadas. Certifique-se de que a impressão digital configurada para o proxy de aplicativo Web seja a correta.|
|13032<p>O cliente apresentou um certificado SSL para o proxy de aplicativo Web, mas o certificado não era válido para o uso solicitado.|Esse evento pode indicar um problema na configuração de data e hora.|Verifique se a infraestrutura de certificado é válida e se a hora e a data do proxy de aplicativo Web e as AD FS estão sincronizadas. Certifique-se de que a impressão digital configurada para o proxy de aplicativo Web seja a correta.|
|13033<p>O cliente apresentou um certificado SSL para o proxy de aplicativo Web, mas o certificado não estava dentro de seu período de validade ao verificar em relação ao relógio do sistema atual ou ao carimbo de data/hora no arquivo assinado.|Esse evento pode indicar um problema na configuração de data e hora.|Verifique se a infraestrutura de certificado é válida e se a hora e a data do proxy de aplicativo Web e as AD FS estão sincronizadas. Certifique-se de que a impressão digital configurada para o proxy de aplicativo Web seja a correta.|
|13034<p>O cliente apresentou um certificado SSL para o proxy de aplicativo Web, mas o certificado não era válido.|Esse evento pode indicar um problema na configuração de data e hora.|Verifique se a infraestrutura de certificado é válida e se a hora e a data do proxy de aplicativo Web e as AD FS estão sincronizadas. Certifique-se de que a impressão digital configurada para o proxy de aplicativo Web seja a correta.|

Os eventos do console do administrador a seguir geralmente são um indicativo de problemas que têm a ver com a configuração, como provisionamento, solicitação que não é bem-sucedida, servidores de back-end que estão inacessíveis e estouros de buffer.

|Evento ou sintoma|Causa possível|Resolução|
|--------------------|------------------|--------------|
|12019<p>O proxy de aplicativo Web não pôde criar um ouvinte para a URL a seguir.|Uma possível causa do evento é que outro serviço está ouvindo a mesma URL.|O administrador deve garantir que ninguém escute ou se associa às mesmas URLs. Para verificar isso, execute o comando: netsh http show urlacl. Se essa URL for usada por outro componente em execução no computador de proxy de aplicativo Web, remova-a ou use uma URL diferente para publicar os aplicativos por meio do proxy de aplicativo Web.|
|12020<p>O proxy de aplicativo Web não pôde criar uma reserva para a URL a seguir.|Uma possível causa do evento é que outro serviço tem uma reserva na mesma URL.|O administrador deve garantir que ninguém seja associado às mesmas URLs. Para verificar isso, execute o comando: netsh http show urlacl. Se essa URL for usada por outro componente em execução no computador de proxy de aplicativo Web, remova-a ou use uma URL diferente para publicar os aplicativos por meio do proxy de aplicativo Web.|
|12021<p>O proxy de aplicativo Web não pôde associar o certificado do servidor SSL. Todas as outras definições de configuração foram aplicadas.|Não é possível criar e definir um registro de configuração de dados de certificado SSL.|Verifique se as impressões digitais do certificado configuradas para o aplicativo Web Proxyapplications estão instaladas em todos os computadores proxy de aplicativo Web com uma chave privada no repositório do computador local.|
|13001<p>O certificado do servidor SSL apresentado ao proxy de aplicativo Web pelo servidor back-end não é válido; o certificado não é confiável.|Um ou mais erros foram encontrados no certificado de protocolo SSL (SSL) enviado pelo servidor. Isso pode indicar que o servidor back-end forneceu um SSL que não era válido ou que não há nenhuma relação de confiança entre o proxy do aplicativo Web e o servidor back-end.|Valide um certificado SSL do servidor de back-end. Verifique se o computador proxy de aplicativo Web está configurado com as CAs raiz corretas para confiar no certificado do servidor back-end.|
|13006|Quando o código de erro é 0x80072EE7, o failurrre é causado pela incapacidade de resolver a URL do servidor de back-end. Outros códigos de erro são descritos em[https://msdn.microsoft.com/library/windows/desktop/aa384110(v=vs.85)](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn280944(v=ws.11))|Verifique se a URL do servidor de back-end está correta e se seu nome pode ser resolvido corretamente no computador do proxy de aplicativo Web.|
|13007<p>A resposta HTTP do servidor back-end não foi recebida dentro do intervalo esperado.|A solicitação do servidor back-end atingiu o tempo limite ou está lenta ou não responde.|Verifique a configuração do servidor back-end. Se for muito lento, verifique a conectividade com o servidor de back-end e considere também alterar o cmdlet de parâmetro de configuração global do proxy de aplicativo Web para InactiveTransactionsTimeoutSec.|

## <a name="see-also"></a>Consulte Também
[O que há de novo no proxy de aplicativo Web no Windows Server 2016](web-application-proxy-windows-server.md) 
 [Trabalhando com o proxy de aplicativo Web](assetId:///b607b717-2172-4271-98d1-fa8162e0bb2e)

